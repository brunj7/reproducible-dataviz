---
title: "intro_rmarkdown"
author: "Julien Brun, NCEAS"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


--

**End of default example**

--

## Some Markdown fun

### Adding an image

- Markdown way: 

```
![LTER logo](https://lternet.edu/wp-content/uploads/2018/02/LTER-network-horizontal.png)
```
![LTER logo](https://lternet.edu/wp-content/uploads/2018/02/LTER-network-horizontal.png)

**=> not much control!!!**

<br>

- Using HTML tags: 

<br>

<img src="https://lternet.edu/wp-content/uploads/2018/02/LTER-network-horizontal.png" width="50%" align="right" alt="LTER logo" />
```
<img src="https://lternet.edu/wp-content/uploads/2018/02/LTER-network-horizontal.png" width="50%" align="right" alt="LTER logo" />
```

<br>
<br>

- Using code chunks: 

```{r, LTER logo, out.width='50%', fig.align="right", fig.cap="LTER logo", results='hide'}
  knitr::include_graphics("https://lternet.edu/wp-content/uploads/2018/02/LTER-network-horizontal.png")
```


```{r, LTER logo chunk, out.width='50%', fig.align="center", fig.cap="LTER logo", echo=FALSE}
knitr::include_graphics("https://lternet.edu/wp-content/uploads/2018/02/LTER-network-horizontal.png")
```
Note: since this work with a URL... you can add GIFs

```{r, cat five, out.width='50%', fig.align="center", fig.cap="cat five", echo=FALSE}
knitr::include_graphics("https://media.giphy.com/media/10ZEx0FoCU2XVm/giphy.gif")
```

### Adding an URL

Pure markdown: <http://www.lternet.edu>

This will also work: http://www.lternet.edu

Adding link to a word: [LTER](http://www.lternet.edu)

Opening the link in a new window (R Markdown): [LTER](http://www.lternet.edu){target="_blank"}

--

## Insert our first code chunk

- From GUI
- Using keyboard code chunk: `Ctrl` + `Alt` + `I` (`Cmd` + `Option` + `I` on macOS).

```{r iris median no param}

library(tidyverse)

iris_avg <- iris %>%
  group_by(Species) %>%
  summarise_all(funs(median = median))

iris_avg

```
Well, we do not want the `Tidyverse` message...

```{r iris median, message=FALSE}

library(tidyverse)

iris_avg <- iris %>%
  group_by(Species) %>%
  summarise_all(funs(median = median))

iris_avg

```


## Some basic plotting

```{r iris median plot}
barplot(iris_avg$Sepal.Length_median, names = iris_avg$Species)
```

- Discuss the plot and how to remove the code above the plot
- Show we can add a legend

```{r iris median plot with caption, echo=FALSE, fig.cap="Median Sepal Length"}
barplot(iris_avg$Sepal.Length_median, names = iris_avg$Species)
```
## Tables


### Markdown

|   x |   y |   z |
|-----|-----|-----|
|   1 |   2 |   3 |
|   4 |   5 |   6 |

**=> Tidious!!**


### You can render tables of data frames in R Markdown

```{r my first table}
knitr::kable(iris_avg, caption = "Iris Median data")
```

But not that convenient if the table is large:

```{r large table}
knitr::kable(iris, caption = "Iris data")
```


--


## Embedding interactive elements - HTML widgets

You can use html widgets to add some interactivity to your R markdown documents


### Interactive table

To let the user be able to explore the data, we can create an interactive table

```{r interactive table}
library(DT)
DT::datatable(iris)
```


### Interactive Maps

We have a csv file with the all the LTER sites. We can read this file and create an interactive maps in few lines of code

- Show the leaflet
- Render => discuss the `read_csv` message
- How to fix this => `message-FALSE`
- Add a caption

```{r leaflet, message = FALSE, fig.cap= "LTER sites of the contiguous US"}
library(leaflet)

# Read the LTER sites
lter_sites <- read_csv("./data/LTER_sites.csv")

# Map of the contiguous US LTER sites
leaflet(data=lter_sites) %>% addTiles() %>% setView(-98, 40, zoom = 4) %>% addCircleMarkers(~Longitude, ~Latitude, popup = ~Code)
```


## Inline code 

**You can use R to compute values within your text documentation**

For example, you could compute the number of LTER sites from the csv files we used. So if this file is updated because 2 new LTER sites are added by NSF, your text will be automatically updated accordingly!

You can add inline code outside the chunks by using single quotation:
```{r LTER site count, echo=TRUE, eval=FALSE}
There are `r nrow(lter_sites)` US LTER sites!
```

This will render as:  
**There are `r nrow(lter_sites)` US LTER sites!**


As today, `r Sys.Date()`, There are `r nrow(lter_sites)` US LTER sites!
--



## Global Chunk Options

**As you can set options for code chunks, you can set the same for all the chunks of the R markdown document.**


### Output folder 

For example, we could want to save all our plots in a specific folder

```{r global options folder}
knitr::opts_chunk$set(fig.path = "./figures/") 
```

### Set your figure size for all

```{r globaal figure size}
knitr::opts_chunk$set(fig.width=12, fig.height=8)
```

## Set your figure type to `PNG`

```{r globaal figure size}
knitr::opts_chunk$set(dev = "png")
```

### Default `Knit` options

Want to know your default knit options?

```{r default knit, eval=FALSE}
str(knitr::opts_chunk$get())
```

--

## Knit Options via `YAML`

### Adding a table of content

```{YAML}
---
title: "intro_rmarkdown"
author: "Julien Brun, NCEAS"
output:
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    keep_markdown_true
---
```

### Adding numbering to headers

```{YAML}
---
title: "intro_rmarkdown"
author: "Julien Brun, NCEAS"
output:
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    number_sections: true
---
```

### Keep the Markdown document

```{YAML}
---
title: "intro_rmarkdown"
author: "Julien Brun, NCEAS"
output:
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    number_sections: true
    keep_md: true
---
```

## Bibliography

```{YAML}
---
title: "intro_rmarkdown"
author: "Julien Brun, NCEAS"
output:
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    number_sections: true
bibliography: references.bib
---
```

Most of this material and more can be found in [@xie_r_2018]


- add `# References` header at the end of the document

- Most of this material and more can be found in [@xie_r_2018; @RMarkdown]

